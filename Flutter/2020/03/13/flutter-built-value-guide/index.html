<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mengdd.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Flutter json 2 model with Built ValueFlutter中json转换model, 除了手动转之外, 就是利用第三方库做一些代码生成.流行的库有: json_serializable和built_value 本文介绍built_value的实际使用及问题处理.">
<meta property="og:type" content="article">
<meta property="og:title" content="Flutter json 2 model with Built Value">
<meta property="og:url" content="http://mengdd.github.io/Flutter/2020/03/13/flutter-built-value-guide/index.html">
<meta property="og:site_name" content="Meng&#39;s pages">
<meta property="og:description" content="Flutter json 2 model with Built ValueFlutter中json转换model, 除了手动转之外, 就是利用第三方库做一些代码生成.流行的库有: json_serializable和built_value 本文介绍built_value的实际使用及问题处理.">
<meta property="og:locale">
<meta property="article:published_time" content="2020-03-13T08:18:13.000Z">
<meta property="article:modified_time" content="2022-01-29T16:37:09.005Z">
<meta property="article:author" content="Dandan Meng">
<meta property="article:tag" content="Flutter">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://mengdd.github.io/Flutter/2020/03/13/flutter-built-value-guide/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>Flutter json 2 model with Built Value | Meng's pages</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?83e8338b542a9fd155f68673d113e0ae";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Meng's pages</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Android developer and maybe other intersting things.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://mengdd.github.io/Flutter/2020/03/13/flutter-built-value-guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
      <meta itemprop="name" content="Dandan Meng">
      <meta itemprop="description" content="This is a technical blog site of an Android developer.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meng's pages">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Flutter json 2 model with Built Value
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-13 16:18:13" itemprop="dateCreated datePublished" datetime="2020-03-13T16:18:13+08:00">2020-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-30 00:37:09" itemprop="dateModified" datetime="2022-01-30T00:37:09+08:00">2022-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/" itemprop="url" rel="index"><span itemprop="name">Flutter</span></a>
                </span>
            </span>

          
            <span id="/Flutter/2020/03/13/flutter-built-value-guide/" class="post-meta-item leancloud_visitors" data-flag-title="Flutter json 2 model with Built Value" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/Flutter/2020/03/13/flutter-built-value-guide/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="Flutter/2020/03/13/flutter-built-value-guide/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Flutter-json-2-model-with-Built-Value"><a href="#Flutter-json-2-model-with-Built-Value" class="headerlink" title="Flutter json 2 model with Built Value"></a>Flutter json 2 model with Built Value</h1><p>Flutter中json转换model, 除了手动转之外, 就是利用第三方库做一些代码生成.<br>流行的库有: <a href="https://pub.dev/packages/json_serializable" target="_blank" rel="noopener">json_serializable</a>和<a href="https://pub.dev/packages/built_value" target="_blank" rel="noopener">built_value</a></p>
<p>本文介绍<a href="https://pub.dev/packages/built_value" target="_blank" rel="noopener">built_value</a>的实际使用及问题处理.</p>
<a id="more"></a>
<h2 id="Flutter中的json转model方法"><a href="#Flutter中的json转model方法" class="headerlink" title="Flutter中的json转model方法"></a>Flutter中的json转model方法</h2><p>Flutter中json到model类型的转换可以有多种方式:</p>
<ul>
<li>利用官方自带的dart convert中的json解码. 该方法只能将json转换为List或Map, 剩下的工作需要手动完成, 根据key取值赋值给model的字段.</li>
<li>利用第三方的库, 做代码生成, 流行的库有: <a href="https://pub.dev/packages/json_serializable" target="_blank" rel="noopener">json_serializable</a>和<a href="https://pub.dev/packages/built_value" target="_blank" rel="noopener">built_value</a>. 原理都是相同的, 先写一些模板代码, 说明一下model是什么样子的, 然后运行命令行生成一些代码, 之后就可以很方便地调用, 将json转换为model了.</li>
</ul>
<p>使用json_serializable可以看:</p>
<ul>
<li>官网的例子: <a href="https://flutter.dev/docs/development/data-and-backend/json#code-generation" target="_blank" rel="noopener">Serializing JSON using code generation libraries</a>.</li>
<li>Flutter实战中文的: <a href="https://book.flutterchina.club/chapter11/json_model.html" target="_blank" rel="noopener">11.7 Json转Dart Model类</a></li>
</ul>
<p>本篇文章主要介绍built value的使用.</p>
<h2 id="built-value使用指南"><a href="#built-value使用指南" class="headerlink" title="built value使用指南"></a>built value使用指南</h2><p>实例: 用github api拿到的events: <a href="https://api.github.com/events?per_page=10" target="_blank" rel="noopener">https://api.github.com/events?per_page=10</a><br>如何转化成model对象呢?</p>
<h3 id="TDD"><a href="#TDD" class="headerlink" title="TDD"></a>TDD</h3><p>先写个测试, 明确一下我们想要的目标.</p>
<p>在<code>test</code>下建立一个文件, 比如叫<code>json_test.dart</code>.</p>
<p>里面写main函数和两个测试:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">void main() &#123;</span><br><span class="line">  test(&quot;parse events list&quot;, () &#123;</span><br><span class="line">    const jsonString = &quot;&quot;&quot;replace with events list json string&quot;&quot;&quot;;</span><br><span class="line"></span><br><span class="line">    expect(Event.fromEventsListJson(jsonString).first.id, &quot;11732023561&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  test(&quot;parse event&quot;, () &#123;</span><br><span class="line">    const jsonString = &quot;&quot;&quot;replace with event json string&quot;&quot;&quot;;</span><br><span class="line"></span><br><span class="line">    expect(Event.fromJson(jsonString).id, &quot;11732036753&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里面应该放json字符串的, 太长了我就省略了, 这样看比较清晰.</p>
<p>用<code>&quot;&quot;&quot;</code>之后可以支持多行. (IDE里面可以折叠的.)</p>
<p>这个<code>Event</code>类和方法我们都还没有写, 所以暂时报错.</p>
<h3 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h3><p>添加依赖, 去package页面看添加什么版本: <a href="https://pub.dev/packages/built_value" target="_blank" rel="noopener">https://pub.dev/packages/built_value</a></p>
<p>在<code>pubspec.yaml</code>中添加:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  flutter:</span><br><span class="line">    sdk: flutter</span><br><span class="line"></span><br><span class="line">  # other dependencies here</span><br><span class="line"></span><br><span class="line">  built_value: ^7.0.9</span><br><span class="line">  built_collection: ^4.3.2</span><br><span class="line"></span><br><span class="line">dev_dependencies:</span><br><span class="line">  flutter_test:</span><br><span class="line">    sdk: flutter</span><br><span class="line"></span><br><span class="line">  # other dev_dependencies here</span><br><span class="line"></span><br><span class="line">  build_runner: ^1.8.0</span><br><span class="line">  built_value_generator: ^7.0.9</span><br></pre></td></tr></table></figure></p>
<p>然后点<code>Packages get</code>.</p>
<h3 id="Live-Templates"><a href="#Live-Templates" class="headerlink" title="Live Templates"></a>Live Templates</h3><p>这个是IntelliJ系IDE(包括Android Studio)的快捷设置, 目的是为了减少手动输入. (可选.)</p>
<p>打开<code>Preferences</code>, 搜<code>Live Templates</code>.<br>在<code>Dart</code>的部分点+号新增一个Live Template.</p>
<p>下面Abbreviation选一个适当的缩写, 比如<code>built</code>.<br>Template text贴入这段:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">abstract class $CLASS_NAME$ implements Built&lt;$CLASS_NAME$, $CLASS_NAME$Builder&gt; &#123;</span><br><span class="line">  $CLASS_NAME$._();</span><br><span class="line">  factory $CLASS_NAME$([void Function($CLASS_NAME$Builder) updates]) = _$$$CLASS_NAME$;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Applicable in Dart选: top-level.</p>
<p>建好之后以后就直接用啦.</p>
<h3 id="建立models抽象类"><a href="#建立models抽象类" class="headerlink" title="建立models抽象类"></a>建立models抽象类</h3><p>输入刚才建立的live template的关键字<code>built</code>, 就会出现要生成的代码, 其中写好自己的类名.</p>
<p>比如我们要建立的model类型是<code>Event</code>类.<br>新建<code>event.dart</code>文件. </p>
<p>在其中输入<code>built</code>按确认之后, 输入类名<code>Event</code>, 就建好了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">abstract class Event implements Built&lt;Event, EventBuilder&gt; &#123;</span><br><span class="line">  Event._();</span><br><span class="line">  factory Event([void Function(EventBuilder) updates]) = _$Event;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>包括一个私有构造和一个工厂方法. 此时会有一些红色的报错.<br>这里<code>import &#39;package:built_value/built_value.dart&#39;</code>消除<code>Built</code>类的报错.</p>
<p>根据观察API: <a href="https://api.github.com/events" target="_blank" rel="noopener">https://api.github.com/events</a> 返回的json, 发现还应该有<code>Actor</code>, <code>Repo</code>, <code>Payload</code>三个类.<br>也都按这个方法建立好.</p>
<p>然后在其中添加字段, 现在看起来是这样了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import &apos;package:built_value/built_value.dart&apos;;</span><br><span class="line">// imports for models</span><br><span class="line"></span><br><span class="line">part &apos;event.g.dart&apos;;</span><br><span class="line"></span><br><span class="line">abstract class Event implements Built&lt;Event, EventBuilder&gt; &#123;</span><br><span class="line">  String get id;</span><br><span class="line"></span><br><span class="line">  String get type;</span><br><span class="line"></span><br><span class="line">  Actor get actor;</span><br><span class="line"></span><br><span class="line">  Repo get repo;</span><br><span class="line"></span><br><span class="line">  Payload get payload;</span><br><span class="line"></span><br><span class="line">  bool get public;</span><br><span class="line"></span><br><span class="line">  String get createdAt;</span><br><span class="line"></span><br><span class="line">  Event._();</span><br><span class="line"></span><br><span class="line">  factory Event([void Function(EventBuilder) updates]) = _$Event;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>很重要的一步, 就是在类前面添加上一句: <code>part &#39;event.g.dart&#39;;</code>.<br><code>g.dart</code>是一个惯例, 表明这个文件是生成的代码. <code>part</code>表示目前这个文件是另一个文件的一部分.</p>
<p>按照同样的方法把几个类都建好.</p>
<p>注意如果有列表字段, 要声明为<code>BuiltList</code>类型.</p>
<h3 id="运行生成命令"><a href="#运行生成命令" class="headerlink" title="运行生成命令"></a>运行生成命令</h3><p>生成命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter packages pub run build_runner build</span><br></pre></td></tr></table></figure></p>
<p>需要持续构建和可以用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter packages pub run build_runner watch</span><br></pre></td></tr></table></figure></p>
<p>这样就不用每次改完代码都需要跑一次命令了.</p>
<p>我们这里用watch, 因为还没有改完.<br>运行完成之后, 可以看到<code>.g.dart</code>的文件们都生成了, 报错也消失了.</p>
<h3 id="写Serializers"><a href="#写Serializers" class="headerlink" title="写Serializers"></a>写Serializers</h3><p>新建文件<code>serializers.dart</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &apos;package:built_value/serializer.dart&apos;;</span><br><span class="line">import &apos;package:built_value/standard_json_plugin.dart&apos;;</span><br><span class="line"></span><br><span class="line">// imports for models</span><br><span class="line"></span><br><span class="line">part &apos;serializers.g.dart&apos;;</span><br><span class="line"></span><br><span class="line">@SerializersFor(const [</span><br><span class="line">  Event,</span><br><span class="line">  Actor,</span><br><span class="line">  Repo,</span><br><span class="line">  Payload,</span><br><span class="line">])</span><br><span class="line">final Serializers serializers =</span><br><span class="line">    (_$serializers.toBuilder()..addPlugin(StandardJsonPlugin())).build();</span><br></pre></td></tr></table></figure>
<p><code>@SerializersFor</code>里面列出想要序列化的类.</p>
<p>注意这里要加上<code>StandardJsonPlugin</code>, 因为built value的json格式不是标准的, 而是所有字段逗号分隔的.<br>用了<code>StandardJsonPlugin</code>之后就转换成了标准的JSON格式.</p>
<p>因为我们跑命令的时候用的是<code>watch</code>, 所以保存修改后<code>serializers.g.dart</code>文件此时自动生成了.</p>
<h3 id="添加model序列化和反序列化代码"><a href="#添加model序列化和反序列化代码" class="headerlink" title="添加model序列化和反序列化代码"></a>添加model序列化和反序列化代码</h3><p>在Event类中添加:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static Serializer&lt;Event&gt; get serializer =&gt; _$eventSerializer;</span><br><span class="line"></span><br><span class="line">String toJson() &#123;</span><br><span class="line">  return json.encode(serializers.serializeWith(Event.serializer, this));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static Event fromJson(String jsonString) &#123;</span><br><span class="line">  return serializers.deserializeWith(</span><br><span class="line">      Event.serializer, json.decode(jsonString));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>import中除了model类还有:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &apos;dart:convert&apos;;</span><br><span class="line"></span><br><span class="line">import &apos;package:built_value/built_value.dart&apos;;</span><br><span class="line">import &apos;package:built_value/serializer.dart&apos;;</span><br><span class="line">import &apos;serializers.dart&apos;;</span><br></pre></td></tr></table></figure></p>
<p>此时其他几个model类也要添加<code>serializer</code>, 比如<code>Actor</code>类中添加:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static Serializer&lt;Actor&gt; get serializer =&gt; _$actorSerializer;</span><br></pre></td></tr></table></figure></p>
<p>重新build生成代码, 报错消失.</p>
<p>现在可以运行测试:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test(&quot;parse event&quot;, () &#123;</span><br><span class="line">  const jsonString = &quot;&quot;&quot;replace with event json string&quot;&quot;&quot;;</span><br><span class="line"></span><br><span class="line">  expect(Event.fromJson(jsonString).id, &quot;11732036753&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>来检验单个的Event model建立.</p>
<p>可能会遇到的失败情况:</p>
<ul>
<li>一些字段需要被标记为可为空<code>@nullable</code>.</li>
<li>一些字段名和key不匹配, 用<code>@BuiltValueField</code>的<code>wireName</code>标记.<br>详见后面的<code>Troubleshooting</code>部分.</li>
</ul>
<h3 id="如何反序列化顶层列表"><a href="#如何反序列化顶层列表" class="headerlink" title="如何反序列化顶层列表?"></a>如何反序列化顶层列表?</h3><p>Event的API返回的是一个Event的数组: <code>[]</code>. 这种怎么做呢?</p>
<p>这里有个issue就是关于这个问题, 里面的解决办法挺好: <a href="https://github.com/google/built_value.dart/issues/565" target="_blank" rel="noopener">https://github.com/google/built_value.dart/issues/565</a></p>
<p>在<code>serializers.dart</code>中添加方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">T deserialize&lt;T&gt;(dynamic value) =&gt;</span><br><span class="line">    serializers.deserializeWith&lt;T&gt;(serializers.serializerForType(T), value);</span><br><span class="line"></span><br><span class="line">BuiltList&lt;T&gt; deserializeListOf&lt;T&gt;(dynamic value) =&gt; BuiltList.from(</span><br><span class="line">    value.map((value) =&gt; deserialize&lt;T&gt;(value)).toList(growable: false));</span><br></pre></td></tr></table></figure></p>
<p>其中<code>BuiltList</code>需要<code>import &#39;package:built_collection/built_collection.dart&#39;;</code>.</p>
<p>反序列化<code>Event</code>数组的方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static List&lt;Event&gt; fromEventsListJson(String jsonString) &#123;</span><br><span class="line">  final BuiltList&lt;Event&gt; listOfEvents =</span><br><span class="line">      deserializeListOf&lt;Event&gt;(json.decode(jsonString));</span><br><span class="line">  return listOfEvents.toList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>到这一步, 跑我们开头写的两个测试应该都绿了. 如果没绿见<code>Troubleshooting</code>部分.</p>
<h3 id="泛型的fromJson方法"><a href="#泛型的fromJson方法" class="headerlink" title="泛型的fromJson方法."></a>泛型的fromJson方法.</h3><p>上面给<code>serializers</code>中添加了两个方法. 其中第一个方法是一个泛型的<code>fromJson</code>方法.</p>
<p>我们测试中的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(Event.fromJson(jsonString).id, &quot;11732036753&quot;);</span><br></pre></td></tr></table></figure></p>
<p>也可以这样写:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect(deserialize&lt;Event&gt;(json.decode(jsonString)).id, &quot;11732036753&quot;);</span><br></pre></td></tr></table></figure></p>
<p>这样不用给每一个类都写一个<code>fromJson</code>方法了.</p>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><p>可能会有的报错, 问题原因和解决方式.</p>
<h3 id="报错1-failed-due-to-Invalid-argument-s-Unknown-type-on-deserialization-Need-either-specifiedType-or-discriminator-field"><a href="#报错1-failed-due-to-Invalid-argument-s-Unknown-type-on-deserialization-Need-either-specifiedType-or-discriminator-field" class="headerlink" title="报错1: failed due to: Invalid argument(s): Unknown type on deserialization. Need either specifiedType or discriminator field."></a>报错1: <code>failed due to: Invalid argument(s): Unknown type on deserialization. Need either specifiedType or discriminator field.</code></h3><p>比如这个样子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Deserializing &apos;[id, 11732036753, type, PushEvent, actor, &#123;id: 54496419, login: supershell201...&apos; to &apos;Event&apos; failed due to: Invalid argument(s): Unknown type on deserialization. Need either specifiedType or discriminator field.</span><br></pre></td></tr></table></figure></p>
<p>这是因为<code>Event</code>中依赖的类(<code>Actor</code>, <code>Repo</code>, <code>Payload</code>)没有添加serializer.</p>
<p>比如<code>Actor</code>中:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static Serializer&lt;Actor&gt; get serializer =&gt; _$actorSerializer;</span><br></pre></td></tr></table></figure></p>
<p>添加上重新build生成代码即可.</p>
<h3 id="报错2-Tried-to-construct-class-quot-XXX-quot-with-null-field"><a href="#报错2-Tried-to-construct-class-quot-XXX-quot-with-null-field" class="headerlink" title="报错2: Tried to construct class &quot;XXX&quot; with null field"></a>报错2: <code>Tried to construct class &quot;XXX&quot; with null field</code></h3><p>比如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Deserializing &apos;[id, 11732036753, type, PushEvent, actor, &#123;id: 54496419, login: supershell201...&apos; to &apos;Event&apos; failed due to: Deserializing &apos;[id, 54496419, login, supershell2019, display_login, supershell2019, gravatar...&apos; to &apos;Actor&apos; failed due to: Tried to construct class &quot;Actor&quot; with null field &quot;displayLogin&quot;. This is forbidden; to allow it, mark &quot;displayLogin&quot; with @nullable.</span><br></pre></td></tr></table></figure></p>
<p>此时, 先不要着急把字段标记为<code>@nullable</code>.<br>而是要看这个字段是否真的为null, 很有可能是因为字段名称和json中的key不匹配造成的, 比如json中是个蛇形命名.</p>
<p>查看了一下果然就是, 解决办法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@BuiltValueField(wireName: &apos;display_login&apos;)</span><br><span class="line">String get displayLogin;</span><br></pre></td></tr></table></figure></p>
<p>如果字段真的是有可能为null的情况, 那么加上<code>@nullable</code>:<br>比如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@BuiltValueField(wireName: &apos;ref_type&apos;)</span><br><span class="line">@nullable</span><br><span class="line">String get refType;</span><br></pre></td></tr></table></figure></p>
<h3 id="报错3-FormatException-Control-character-in-string"><a href="#报错3-FormatException-Control-character-in-string" class="headerlink" title="报错3: FormatException: Control character in string"></a>报错3: <code>FormatException: Control character in string</code></h3><p>比如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FormatException: Control character in string (at line 25, character 129)</span><br><span class="line">... replica::on_client_write(dsn::message_ex *request, bool ignore_throttling)</span><br></pre></td></tr></table></figure></p>
<p>相关issue: <a href="https://github.com/dart-lang/convert/issues/10" target="_blank" rel="noopener">https://github.com/dart-lang/convert/issues/10</a></p>
<p>解决的办法就是在测试的字符串声明前加一个<code>r</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const jsonString = r&quot;&quot;&quot;replace with events list json string&quot;&quot;&quot;;</span><br></pre></td></tr></table></figure></p>
<h2 id="Model生成工具推荐"><a href="#Model生成工具推荐" class="headerlink" title="Model生成工具推荐"></a>Model生成工具推荐</h2><p>有个很棒的工具: <a href="https://charafau.github.io/json2builtvalue/" target="_blank" rel="noopener">https://charafau.github.io/json2builtvalue/</a><br>左边输入json字符串, 写好命名, 点击之后右边就会出现那些本来需要手动写的代码.</p>
<p>生成的<code>Event</code>类是这样:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">library event;</span><br><span class="line"></span><br><span class="line">import &apos;dart:convert&apos;;</span><br><span class="line"></span><br><span class="line">import &apos;package:built_collection/built_collection.dart&apos;;</span><br><span class="line">import &apos;package:built_value/built_value.dart&apos;;</span><br><span class="line">import &apos;package:built_value/serializer.dart&apos;;</span><br><span class="line"></span><br><span class="line">part &apos;event.g.dart&apos;;</span><br><span class="line"></span><br><span class="line">abstract class Event implements Built&lt;Event, EventBuilder&gt; &#123;</span><br><span class="line">  Event._();</span><br><span class="line"></span><br><span class="line">  factory Event([updates(EventBuilder b)]) = _$Event;</span><br><span class="line"></span><br><span class="line">  @BuiltValueField(wireName: &apos;id&apos;)</span><br><span class="line">  String get id;</span><br><span class="line">  @BuiltValueField(wireName: &apos;type&apos;)</span><br><span class="line">  String get type;</span><br><span class="line">  @BuiltValueField(wireName: &apos;actor&apos;)</span><br><span class="line">  Actor get actor;</span><br><span class="line">  @BuiltValueField(wireName: &apos;repo&apos;)</span><br><span class="line">  Repo get repo;</span><br><span class="line">  @BuiltValueField(wireName: &apos;payload&apos;)</span><br><span class="line">  Payload get payload;</span><br><span class="line">  @BuiltValueField(wireName: &apos;public&apos;)</span><br><span class="line">  bool get public;</span><br><span class="line">  @BuiltValueField(wireName: &apos;created_at&apos;)</span><br><span class="line">  String get createdAt;</span><br><span class="line">  String toJson() &#123;</span><br><span class="line">    return json.encode(serializers.serializeWith(Event.serializer, this));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static Event fromJson(String jsonString) &#123;</span><br><span class="line">    return serializers.deserializeWith(</span><br><span class="line">        Event.serializer, json.decode(jsonString));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static Serializer&lt;Event&gt; get serializer =&gt; _$eventSerializer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>哈哈, 看到这里是不是有种被骗了的感觉.</p>
<p>有了这个很棒的工具之后根本不用自己很小心地写一个一个model类了, 只需要写一个<code>serializers.dart</code>文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">part &apos;serializers.g.dart&apos;;</span><br><span class="line"></span><br><span class="line">@SerializersFor(const [</span><br><span class="line">  Event,</span><br><span class="line">  Actor,</span><br><span class="line">  Repo,</span><br><span class="line">  Payload,</span><br><span class="line">])</span><br><span class="line">final Serializers serializers =</span><br><span class="line">    (_$serializers.toBuilder()..addPlugin(StandardJsonPlugin())).build();</span><br><span class="line"></span><br><span class="line">T deserialize&lt;T&gt;(dynamic value) =&gt;</span><br><span class="line">    serializers.deserializeWith&lt;T&gt;(serializers.serializerForType(T), value);</span><br><span class="line"></span><br><span class="line">BuiltList&lt;T&gt; deserializeListOf&lt;T&gt;(dynamic value) =&gt; BuiltList.from(</span><br><span class="line">    value.map((value) =&gt; deserialize&lt;T&gt;(value)).toList(growable: false));</span><br></pre></td></tr></table></figure></p>
<p>然后把要反序列化的类加进来, 再跑命令行生成代码, 就可以了.</p>
<p>经历一下前面的手动过程可能理解得更好一些, 也知道各种问题的原因.<br>以后使用直接用工具就方便多了.</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>官方文档: <a href="https://flutter.dev/docs/development/data-and-backend/json" target="_blank" rel="noopener">https://flutter.dev/docs/development/data-and-backend/json</a></li>
<li>Flutter实战11.7: <a href="https://book.flutterchina.club/chapter11/json_model.html" target="_blank" rel="noopener">https://book.flutterchina.club/chapter11/json_model.html</a></li>
<li><a href="https://github.com/google/built_value.dart" target="_blank" rel="noopener">built value github</a></li>
<li>生成工具: <a href="https://charafau.github.io/json2builtvalue/" target="_blank" rel="noopener">https://charafau.github.io/json2builtvalue/</a></li>
</ul>

    </div>

    
    
    
        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/uploads/qrcode_for_gh_0e2ed690dcda_258.jpg">
            <span class="icon">
              <i class="圣骑士Wind"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Flutter/" rel="tag"># Flutter</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Kotlin/Android/2020/02/08/kotlin-android-lint-tools/" rel="prev" title="Kotlin Android项目静态检查工具的使用">
      <i class="fa fa-chevron-left"></i> Kotlin Android项目静态检查工具的使用
    </a></div>
      <div class="post-nav-item">
    <a href="/Flutter/2020/03/20/flutter-state-management/" rel="next" title="为了弄懂Flutter的状态管理, 我用10种方法改造了counter app">
      为了弄懂Flutter的状态管理, 我用10种方法改造了counter app <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Flutter-json-2-model-with-Built-Value"><span class="nav-number">1.</span> <span class="nav-text">Flutter json 2 model with Built Value</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Flutter%E4%B8%AD%E7%9A%84json%E8%BD%ACmodel%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">Flutter中的json转model方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#built-value%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97"><span class="nav-number">1.2.</span> <span class="nav-text">built value使用指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TDD"><span class="nav-number">1.2.1.</span> <span class="nav-text">TDD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setup"><span class="nav-number">1.2.2.</span> <span class="nav-text">setup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Live-Templates"><span class="nav-number">1.2.3.</span> <span class="nav-text">Live Templates</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8Bmodels%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="nav-number">1.2.4.</span> <span class="nav-text">建立models抽象类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%94%9F%E6%88%90%E5%91%BD%E4%BB%A4"><span class="nav-number">1.2.5.</span> <span class="nav-text">运行生成命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99Serializers"><span class="nav-number">1.2.6.</span> <span class="nav-text">写Serializers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0model%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="nav-number">1.2.7.</span> <span class="nav-text">添加model序列化和反序列化代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A1%B6%E5%B1%82%E5%88%97%E8%A1%A8"><span class="nav-number">1.2.8.</span> <span class="nav-text">如何反序列化顶层列表?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%9B%E5%9E%8B%E7%9A%84fromJson%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.9.</span> <span class="nav-text">泛型的fromJson方法.</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshooting"><span class="nav-number">1.3.</span> <span class="nav-text">Troubleshooting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%A5%E9%94%991-failed-due-to-Invalid-argument-s-Unknown-type-on-deserialization-Need-either-specifiedType-or-discriminator-field"><span class="nav-number">1.3.1.</span> <span class="nav-text">报错1: failed due to: Invalid argument(s): Unknown type on deserialization. Need either specifiedType or discriminator field.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%A5%E9%94%992-Tried-to-construct-class-quot-XXX-quot-with-null-field"><span class="nav-number">1.3.2.</span> <span class="nav-text">报错2: Tried to construct class &quot;XXX&quot; with null field</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%A5%E9%94%993-FormatException-Control-character-in-string"><span class="nav-number">1.3.3.</span> <span class="nav-text">报错3: FormatException: Control character in string</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Model%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%E6%8E%A8%E8%8D%90"><span class="nav-number">1.4.</span> <span class="nav-text">Model生成工具推荐</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">1.5.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Dandan Meng"
      src="/uploads/avatar.jpeg">
  <p class="site-author-name" itemprop="name">Dandan Meng</p>
  <div class="site-description" itemprop="description">This is a technical blog site of an Android developer.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">84</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">314</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/mengdd" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;mengdd" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.cnblogs.com/mengdd/" title="http:&#x2F;&#x2F;www.cnblogs.com&#x2F;mengdd&#x2F;" rel="noopener" target="_blank">圣骑士Wind@博客园</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.jianshu.com/u/c4192d22f989" title="http:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;c4192d22f989" rel="noopener" target="_blank">圣骑士Wind@简书</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://juejin.im/user/57ca63748ac247006446cf26" title="https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;57ca63748ac247006446cf26" rel="noopener" target="_blank">圣骑士Wind@掘金</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dandan Meng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"6NRSbfxTnKEHn4YEM8Gf4HdP-gzGzoHsz","app_key":"h6jBdqdDSdfOuICNkOVq2DQ0","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://dandanmeng.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://mengdd.github.io/Flutter/2020/03/13/flutter-built-value-guide/";
    this.page.identifier = "Flutter/2020/03/13/flutter-built-value-guide/";
    this.page.title = "Flutter json 2 model with Built Value";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://dandanmeng.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
