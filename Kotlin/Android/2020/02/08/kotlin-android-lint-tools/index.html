<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mengdd.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Kotlin Android项目静态检查工具的使用Kotlin Android项目可用的静态检查工具: Android官方的Lint, 第三方的ktlint和detekt.">
<meta property="og:type" content="article">
<meta property="og:title" content="Kotlin Android项目静态检查工具的使用">
<meta property="og:url" content="http://mengdd.github.io/Kotlin/Android/2020/02/08/kotlin-android-lint-tools/index.html">
<meta property="og:site_name" content="Meng&#39;s pages">
<meta property="og:description" content="Kotlin Android项目静态检查工具的使用Kotlin Android项目可用的静态检查工具: Android官方的Lint, 第三方的ktlint和detekt.">
<meta property="og:locale">
<meta property="og:image" content="http://mengdd.github.io/images/android-studio-lint.png">
<meta property="og:image" content="http://mengdd.github.io/images/detekt-rules.png">
<meta property="og:image" content="http://mengdd.github.io/images/detekt-config-formatting-settings.png">
<meta property="article:published_time" content="2020-02-08T07:17:33.000Z">
<meta property="article:modified_time" content="2022-01-29T16:37:09.005Z">
<meta property="article:author" content="Dandan Meng">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Kotlin">
<meta property="article:tag" content="Tools">
<meta property="article:tag" content="Lint">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://mengdd.github.io/images/android-studio-lint.png">

<link rel="canonical" href="http://mengdd.github.io/Kotlin/Android/2020/02/08/kotlin-android-lint-tools/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>Kotlin Android项目静态检查工具的使用 | Meng's pages</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?83e8338b542a9fd155f68673d113e0ae";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Meng's pages</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Android developer and maybe other intersting things.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://mengdd.github.io/Kotlin/Android/2020/02/08/kotlin-android-lint-tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
      <meta itemprop="name" content="Dandan Meng">
      <meta itemprop="description" content="This is a technical blog site of an Android developer.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meng's pages">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kotlin Android项目静态检查工具的使用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-08 15:17:33" itemprop="dateCreated datePublished" datetime="2020-02-08T15:17:33+08:00">2020-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-30 00:37:09" itemprop="dateModified" datetime="2022-01-30T00:37:09+08:00">2022-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index"><span itemprop="name">Kotlin</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/Kotlin/Android/2020/02/08/kotlin-android-lint-tools/" class="post-meta-item leancloud_visitors" data-flag-title="Kotlin Android项目静态检查工具的使用" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/Kotlin/Android/2020/02/08/kotlin-android-lint-tools/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="Kotlin/Android/2020/02/08/kotlin-android-lint-tools/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Kotlin-Android项目静态检查工具的使用"><a href="#Kotlin-Android项目静态检查工具的使用" class="headerlink" title="Kotlin Android项目静态检查工具的使用"></a>Kotlin Android项目静态检查工具的使用</h1><p>Kotlin Android项目可用的静态检查工具: Android官方的Lint, 第三方的ktlint和detekt.</p>
<a id="more"></a>
<h2 id="静态检查工具"><a href="#静态检查工具" class="headerlink" title="静态检查工具"></a>静态检查工具</h2><p>静态检查工具, 指不需要运行代码, 对代码进行检查的工具.</p>
<p>不止代码风格, 还可以检查代码的正确性, 是否有安全问题, 是否有性能问题等.</p>
<p>静态检查工具一般都具备可扩展性, 方便使用者制定和添加自己的规则.</p>
<p>比较流行的Java静态检查工具有CheckStyle, FindBugs, PMD等.</p>
<p>Android项目, 用Kotlin语言, 可用的静态检查工具: 官方的Android Lint, ktlint和detekt.</p>
<h2 id="Android-Lint"><a href="#Android-Lint" class="headerlink" title="Android Lint"></a>Android Lint</h2><p>Android官方提供了代码扫描工具, 叫lint.</p>
<p>在Android Studio运行lint, 在菜单中选:<br><code>Analyze -&gt; Inspect Code...</code>, 选择范围, 点<code>OK</code>即可运行.</p>
<p>也可以在命令行:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew lint</span><br></pre></td></tr></table></figure></p>
<p>会分类报告出各种各样的错误.</p>
<h3 id="查看所有的Lint规则"><a href="#查看所有的Lint规则" class="headerlink" title="查看所有的Lint规则"></a>查看所有的Lint规则</h3><p>点击菜单中的<code>Analyze -&gt; Inspect Code...</code>, 在弹框的<code>Inspection profile</code>部分点击表示更多的<code>...</code>按钮, 会弹出框显示当前的所有lint规则.</p>
<p>可以选择是否包括规则, 编辑它们的优先级和应用范围等.</p>
<p><img src="/images/android-studio-lint.png" alt="android lint"></p>
<h3 id="Android-Lint配置"><a href="#Android-Lint配置" class="headerlink" title="Android Lint配置"></a>Android Lint配置</h3><p>全局的配置除了用IDE, 还可以通过<code>lint.xml</code>文件.</p>
<p>还可以在gradle中配置, 比如:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  ...</span><br><span class="line">  lintOptions &#123;</span><br><span class="line">    <span class="comment">// Turns off checks for the issue IDs you specify.</span></span><br><span class="line">    disable <span class="string">'TypographyFractions'</span>,<span class="string">'TypographyQuotes'</span></span><br><span class="line">    <span class="comment">// Turns on checks for the issue IDs you specify. These checks are in</span></span><br><span class="line">    <span class="comment">// addition to the default lint checks.</span></span><br><span class="line">    enable <span class="string">'RtlHardcoded'</span>,<span class="string">'RtlCompat'</span>, <span class="string">'RtlEnabled'</span></span><br><span class="line">    <span class="comment">// To enable checks for only a subset of issue IDs and ignore all others,</span></span><br><span class="line">    <span class="comment">// list the issue IDs with the 'check' property instead. This property overrides</span></span><br><span class="line">    <span class="comment">// any issue IDs you enable or disable using the properties above.</span></span><br><span class="line">    check <span class="string">'NewApi'</span>, <span class="string">'InlinedApi'</span></span><br><span class="line">    <span class="comment">// If set to true, turns off analysis progress reporting by lint.</span></span><br><span class="line">    quiet <span class="literal">true</span></span><br><span class="line">    <span class="comment">// if set to true (default), stops the build if errors are found.</span></span><br><span class="line">    abortOnError <span class="literal">false</span></span><br><span class="line">    <span class="comment">// if true, only report errors.</span></span><br><span class="line">    ignoreWarnings <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>特定代码可以利用<code>@SuprressLint</code>注解.<br>比如: <code>@SuppressLint(&quot;NewApi&quot;)</code>, <code>@SuppressLint(&quot;all&quot;)</code>.</p>
<p>特定xml文件中可以用<code>tools:ignore</code>, 比如<code>tools:ignore=&quot;UnusedResources&quot;</code>, <code>tools:ignore=&quot;NewApi,StringFormatInvalid&quot;</code>, <code>tools:ignore=&quot;all&quot;</code>等.</p>
<h3 id="Android-Lint现状基准快照"><a href="#Android-Lint现状基准快照" class="headerlink" title="Android Lint现状基准快照"></a>Android Lint现状基准快照</h3><p>可以在gradle中进行设置一个baseline:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  lintOptions &#123;</span><br><span class="line">    baseline file(<span class="string">"lint-baseline.xml"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第一次添加这个, 运行lint之后, 会自动创建一个<code>lint-baseline.xml</code>文件, 所有当前的问题都会被写入这个文件.</p>
<p>当再次运行lint, 就只会读这个文件, 作为基准, 只报告新的错误或警告. 并且提示其他原有问题在baseline文件中, 被排除.</p>
<p>如果想重新生成baseline可以手动删除这个文件, 重新进行.</p>
<h2 id="ktlint"><a href="#ktlint" class="headerlink" title="ktlint"></a>ktlint</h2><p><a href="https://github.com/pinterest/ktlint" target="_blank" rel="noopener">ktlint</a></p>
<p>代码风格检查, 遵循的是: <a href="https://developer.android.com/kotlin/style-guide" target="_blank" rel="noopener">Kotlin style guide</a></p>
<p>所有的规则代码:<br><a href="https://github.com/pinterest/ktlint/tree/master/ktlint-ruleset-standard/src/main/kotlin/com/pinterest/ktlint/ruleset/standard" target="_blank" rel="noopener">github: ktlint rule set</a></p>
<h3 id="ktlint安装"><a href="#ktlint安装" class="headerlink" title="ktlint安装"></a>ktlint安装</h3><p>在<code>app/build.gradle</code>中添加:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">configurations &#123;</span><br><span class="line">    ktlint</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    ktlint <span class="string">"com.pinterest:ktlint:0.36.0"</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">task ktlint(<span class="string">type:</span> JavaExec, <span class="string">group:</span> <span class="string">"verification"</span>) &#123;</span><br><span class="line">    description = <span class="string">"Check Kotlin code style."</span></span><br><span class="line">    classpath = configurations.ktlint</span><br><span class="line">    main = <span class="string">"com.pinterest.ktlint.Main"</span></span><br><span class="line">    args <span class="string">"src/**/*.kt"</span></span><br><span class="line">    <span class="comment">// to generate report in checkstyle format prepend following args:</span></span><br><span class="line">    <span class="comment">// "--reporter=plain", "--reporter=checkstyle,output=$&#123;buildDir&#125;/ktlint.xml"</span></span><br><span class="line">    <span class="comment">// see https://github.com/pinterest/ktlint#usage for more</span></span><br><span class="line">&#125;</span><br><span class="line">check.dependsOn ktlint</span><br><span class="line"></span><br><span class="line">task ktlintFormat(<span class="string">type:</span> JavaExec, <span class="string">group:</span> <span class="string">"formatting"</span>) &#123;</span><br><span class="line">    description = <span class="string">"Fix Kotlin code style deviations."</span></span><br><span class="line">    classpath = configurations.ktlint</span><br><span class="line">    main = <span class="string">"com.pinterest.ktlint.Main"</span></span><br><span class="line">    args <span class="string">"-F"</span>, <span class="string">"src/**/*.kt"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ktlint使用"><a href="#ktlint使用" class="headerlink" title="ktlint使用"></a>ktlint使用</h3><p>检查:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew ktlint</span><br></pre></td></tr></table></figure></p>
<p>自动修改:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew ktlintFormat</span><br></pre></td></tr></table></figure></p>
<p>并不是所有问题都可以自动修改, 有的问题需要手动改.</p>
<p>配置中的这句:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">check.dependsOn ktlint</span><br></pre></td></tr></table></figure></p>
<p>把运行检查加到了check task中. 通过:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew check --dry-run</span><br></pre></td></tr></table></figure></p>
<p>可以查看运行<code>check</code> task都会做哪些事情(dry run表示不用实际执行这些任务).</p>
<h3 id="ktlint源码"><a href="#ktlint源码" class="headerlink" title="ktlint源码"></a>ktlint源码</h3><p>看ktlint的源码, 程序的入口是<code>Main.kt</code>文件中的<code>main</code>.</p>
<p>使用的规则集是:<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StandardRuleSetProvider</span> : <span class="type">RuleSetProvider &#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Note: some of these rules may be disabled by default. See the default .editorconfig.</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">()</span></span>: RuleSet = RuleSet(</span><br><span class="line">        <span class="string">"standard"</span>,</span><br><span class="line">        ChainWrappingRule(),</span><br><span class="line">        CommentSpacingRule(),</span><br><span class="line">        FilenameRule(),</span><br><span class="line">        FinalNewlineRule(),</span><br><span class="line">        ImportOrderingRule(),</span><br><span class="line">        IndentationRule(),</span><br><span class="line">        MaxLineLengthRule(),</span><br><span class="line">        ModifierOrderRule(),</span><br><span class="line">        NoBlankLineBeforeRbraceRule(),</span><br><span class="line">        NoConsecutiveBlankLinesRule(),</span><br><span class="line">        NoEmptyClassBodyRule(),</span><br><span class="line">        NoLineBreakAfterElseRule(),</span><br><span class="line">        NoLineBreakBeforeAssignmentRule(),</span><br><span class="line">        NoMultipleSpacesRule(),</span><br><span class="line">        NoSemicolonsRule(),</span><br><span class="line">        NoTrailingSpacesRule(),</span><br><span class="line">        NoUnitReturnRule(),</span><br><span class="line">        NoUnusedImportsRule(),</span><br><span class="line">        NoWildcardImportsRule(),</span><br><span class="line">        ParameterListWrappingRule(),</span><br><span class="line">        SpacingAroundColonRule(),</span><br><span class="line">        SpacingAroundCommaRule(),</span><br><span class="line">        SpacingAroundCurlyRule(),</span><br><span class="line">        SpacingAroundDotRule(),</span><br><span class="line">        SpacingAroundKeywordRule(),</span><br><span class="line">        SpacingAroundOperatorsRule(),</span><br><span class="line">        SpacingAroundParensRule(),</span><br><span class="line">        SpacingAroundRangeOperatorRule(),</span><br><span class="line">        StringTemplateRule()</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到都是代码格式相关的规则.</p>
<p>在线查看: <a href="https://github.com/pinterest/ktlint/tree/master/ktlint-ruleset-standard/src/main/kotlin/com/pinterest/ktlint/ruleset/standard" target="_blank" rel="noopener">ktlint ruleset standard</a></p>
<h2 id="detekt"><a href="#detekt" class="headerlink" title="detekt"></a>detekt</h2><p>Github: <a href="https://github.com/arturbosch/detekt" target="_blank" rel="noopener">detekt</a>也是一个Kotlin的静态分析工具.</p>
<p>官方网站: <a href="https://arturbosch.github.io/detekt/index.html" target="_blank" rel="noopener">detekt</a>.</p>
<h3 id="detekt安装"><a href="#detekt安装" class="headerlink" title="detekt安装"></a>detekt安装</h3><p>在项目根目录的<code>build.gradle</code>文件中添加:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id(<span class="string">"io.gitlab.arturbosch.detekt"</span>).version(<span class="string">"1.5.0"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    apply <span class="string">plugin:</span> <span class="string">'io.gitlab.arturbosch.detekt'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">detekt &#123;</span><br><span class="line">    failFast = <span class="literal">true</span> <span class="comment">// fail build on any finding</span></span><br><span class="line">    buildUponDefaultConfig = <span class="literal">true</span> <span class="comment">// preconfigure defaults</span></span><br><span class="line">    config = files(<span class="string">"$projectDir/config/detekt.yml"</span>)</span><br><span class="line">    <span class="comment">// point to your custom config defining rules to run, overwriting default behavior</span></span><br><span class="line">    baseline = file(<span class="string">"$projectDir/config/baseline.xml"</span>)</span><br><span class="line">    <span class="comment">// a way of suppressing issues before introducing detekt</span></span><br><span class="line"></span><br><span class="line">    reports &#123;</span><br><span class="line">        html.enabled = <span class="literal">true</span> <span class="comment">// observe findings in your browser with structure and code snippets</span></span><br><span class="line">        xml.enabled = <span class="literal">true</span> <span class="comment">// checkstyle like format mainly for integrations like Jenkins</span></span><br><span class="line">        txt.enabled = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// similar to the console output, contains issue signature to manually edit baseline files</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行<code>./gradlew tasks</code>可以看到相关任务被加进去了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">detekt</span><br><span class="line">detektBaseline - Creates a detekt baseline on the given --baseline path.</span><br><span class="line">detektGenerateConfig - Generate a detekt configuration file inside your project.</span><br><span class="line">detektIdeaFormat - Uses an external idea installation to format your code.</span><br><span class="line">detektIdeaInspect - Uses an external idea installation to inspect your code.</span><br></pre></td></tr></table></figure></p>
<h3 id="detekt使用"><a href="#detekt使用" class="headerlink" title="detekt使用"></a>detekt使用</h3><p>运行:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew detekt</span><br></pre></td></tr></table></figure></p>
<p>进行检测.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">detekt &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>块是用来进行自定义的属性设置的.</p>
<p>如果开启了文件输出, 结果在:<br><code>app/build/reports/detekt</code>目录下可以查看.</p>
<p>并且运行<code>./gradlew check --dry-run</code>可以发现, 运行<code>check</code>的时候也会执行<code>detekt</code>.</p>
<p>可以利用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew detektGenerateConfig</span><br></pre></td></tr></table></figure></p>
<p>生成配置文件: <code>config/detekt/detekt.yml</code>. </p>
<p>在配置文件中可以看到对各种规则的开关状态, 编辑它可以进行定制.</p>
<h3 id="detekt源码"><a href="#detekt源码" class="headerlink" title="detekt源码"></a>detekt源码</h3><p>程序的入口在<code>detekt-cli</code>module的<code>Main.kt</code>.<br>根据参数的不同返回不同的<code>Runner</code>.</p>
<p>主要用于检测的是这个<a href="https://github.com/arturbosch/detekt/blob/master/detekt-cli/src/main/kotlin/io/gitlab/arturbosch/detekt/cli/runners/Runner.kt" target="_blank" rel="noopener">Runner</a>, 它的执行方法:<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">execute</span><span class="params">()</span></span> &#123;</span><br><span class="line">    createSettings().use &#123; settings -&gt;</span><br><span class="line">        <span class="keyword">val</span> (checkConfigTime) = measure &#123; checkConfiguration(settings) &#125;</span><br><span class="line">        settings.debug &#123; <span class="string">"Checking config took <span class="variable">$checkConfigTime</span> ms"</span> &#125;</span><br><span class="line">        <span class="keyword">val</span> (serviceLoadingTime, facade) = measure &#123; DetektFacade.create(settings) &#125;</span><br><span class="line">        settings.debug &#123; <span class="string">"Loading services took <span class="variable">$serviceLoadingTime</span> ms"</span> &#125;</span><br><span class="line">        <span class="keyword">var</span> (engineRunTime, result) = measure &#123; facade.run() &#125;</span><br><span class="line">        settings.debug &#123; <span class="string">"Running core engine took <span class="variable">$engineRunTime</span> ms"</span> &#125;</span><br><span class="line">        checkBaselineCreation(result)</span><br><span class="line">        result = transformResult(result)</span><br><span class="line">        <span class="keyword">val</span> (outputResultsTime) = measure &#123; OutputFacade(arguments, result, settings).run() &#125;</span><br><span class="line">        settings.debug &#123; <span class="string">"Writing results took <span class="variable">$outputResultsTime</span> ms"</span> &#125;</span><br><span class="line">        <span class="keyword">if</span> (!arguments.createBaseline) &#123;</span><br><span class="line">            checkBuildFailureThreshold(result, settings)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>读取配置, 创建服务, 执行检测, 转化输出结果.</p>
<p>当没有用户自己声明的配置文件时, 使用的默认配置文件是<a href="https://github.com/arturbosch/detekt/blob/master/detekt-cli/src/main/resources/default-detekt-config.yml" target="_blank" rel="noopener">default-detekt-config.yml</a>.</p>
<p>在这里可以看到对所有规则的默认开关状态.</p>
<p>detekt的规则代码放在<code>detekt-rules</code>这个module下:<br><a href="https://github.com/arturbosch/detekt/tree/master/detekt-rules/src/main/kotlin/io/gitlab/arturbosch/detekt/rules" target="_blank" rel="noopener">detekt rules</a>.<br><img src="/images/detekt-rules.png" alt="detekt rules"></p>
<p>官方文档上也有说明, 比如这是performance分类下的rules: <a href="https://arturbosch.github.io/detekt/performance.html" target="_blank" rel="noopener">detekt performance</a>.</p>
<h3 id="包含ktlint的规则"><a href="#包含ktlint的规则" class="headerlink" title="包含ktlint的规则"></a>包含ktlint的规则</h3><p>detekt的规则种类更多, 并且它包含了ktlint的代码检查规则.<br>所有的<code>ktlint</code>规则被包装在<code>detekt-formatting</code>这个module下, 见: <a href="https://github.com/arturbosch/detekt/tree/master/detekt-formatting/src/main/kotlin/io/gitlab/arturbosch/detekt/formatting/wrappers" target="_blank" rel="noopener">detekt formatting rules</a>.</p>
<p>但是并不是所有规则都默认开启.</p>
<p>在配置文件的<code>formatting</code>块可以查看具体的规则开关状态.<br><img src="/images/detekt-config-formatting-settings.png" alt="detekt config formatting"></p>
<p>如果需要修改定制, 需要生成自己的配置文件.</p>
<h2 id="和Git-hook结合"><a href="#和Git-hook结合" class="headerlink" title="和Git hook结合"></a>和Git hook结合</h2><p>Lint工具的运行可以放在CI上, 也可以每次本地手动跑, 这样在push之前就能发现错误并改正.</p>
<p>一种避免忘记的方法就是使用Git hook.</p>
<p>项目的<code>.git/hooks</code>文件夹下自带一些有意思的sample.</p>
<h3 id="如何使用git-hook"><a href="#如何使用git-hook" class="headerlink" title="如何使用git hook"></a>如何使用git hook</h3><p>只要在<code>.git/hooks</code>路径下添加对应名字的文件, 如<code>pre-push</code>, <code>pre-commit</code>, 写入想要的代码即可.</p>
<p>hook文件返回0表示通过, 会进行下一步操作.<br>否则后面的操作会被放弃.</p>
<p>注意文件要有执行权限:<br><code>chmod +x 文件名</code></p>
<p>如果不想跑hook可以加上 <code>--no-verify</code><br>比如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --no-verify</span><br></pre></td></tr></table></figure></p>
<h3 id="在提交之前运行静态检查"><a href="#在提交之前运行静态检查" class="headerlink" title="在提交之前运行静态检查"></a>在提交之前运行静态检查</h3><p>以ktlint为例, 我们希望每次commit的时候先运行<code>./gradlew ktlint</code>, 如果有issue则放弃提交.</p>
<p>在<code>.git/hooks</code>中添加<code>pre-commit</code>文件, 其中:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;Running ktlint&quot;</span><br><span class="line"></span><br><span class="line">./gradlew ktlint</span><br><span class="line">result=$?</span><br><span class="line">if [ &quot;$result&quot; = 0 ] ; then    </span><br><span class="line">   echo &quot;ktlint found no problems&quot;     </span><br><span class="line">   exit 0</span><br><span class="line">else</span><br><span class="line">   echo &quot;Problems found, files will not be committed.&quot;     </span><br><span class="line">   exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></p>
<p>detekt的添加也是类似, 官网上给了一个例子:<br><a href="https://arturbosch.github.io/detekt/git-pre-commit-hook.html" target="_blank" rel="noopener">detekt/git-pre-commit-hook</a>.</p>
<h3 id="如何track-共享Git-hooks"><a href="#如何track-共享Git-hooks" class="headerlink" title="如何track, 共享Git hooks"></a>如何track, 共享Git hooks</h3><p>因为hooks文件在<code>.git</code>目录里, 只是在本地, 那么在团队成员间如何共享呢?</p>
<p>根据这个问题:<br><a href="https://stackoverflow.com/questions/427207/can-git-hook-scripts-be-managed-along-with-the-repository" target="_blank" rel="noopener">https://stackoverflow.com/questions/427207/can-git-hook-scripts-be-managed-along-with-the-repository</a></p>
<p>从git 2.9开始, 可以设置:<code>core.hooksPath</code>了.</p>
<p>可以在repo里面添加一个目录hooks, 然后把git hooks文件放进去track.</p>
<p>在命令行跑:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config core.hooksPath hooks</span><br></pre></td></tr></table></figure></p>
<p>把找hook文件的目录设置成指定目录就好了.</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了三种静态检查的工具:</p>
<ul>
<li>Android Lint: Android自带的Lint检查. 检查的内容比较丰富.</li>
<li>ktlint: Kotlin代码样式规范检查. 特色: 有自动修正命令.</li>
<li>detekt: 除了code style还有performance, exceptions, bugs等方面的检查. formatting模块包含了ktlint的所有style检查(虽然有的具体的规则默认不开启, 但是可以配置), 是前者的超集.</li>
</ul>
<p>这些工具都可以扩展, 添加自定义的检查规则.</p>
<p>结合Git hook把静态检查在本地进行, 可以实现问题的尽早暴露和修改.</p>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><p><a href="https://github.com/mengdd/AndroidLintDemo" target="_blank" rel="noopener">AndroidLintDemo</a></p>
<ul>
<li>ktlint集成: ktlint分支.</li>
<li>detekt集成: detekt分支.</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://developer.android.com/studio/write/lint" target="_blank" rel="noopener">Android Lint: 官方文档</a></li>
<li><a href="https://github.com/pinterest/ktlint" target="_blank" rel="noopener">ktlint</a></li>
<li><a href="https://github.com/arturbosch/detekt" target="_blank" rel="noopener">detekt</a></li>
<li><a href="http://mouxuejie.com/blog/2019-04-26/kotlin-static-code-analysis/" target="_blank" rel="noopener">Kotlin静态代码检测方案分析</a></li>
</ul>

    </div>

    
    
    
        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/uploads/qrcode_for_gh_0e2ed690dcda_258.jpg">
            <span class="icon">
              <i class="圣骑士Wind"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/Kotlin/" rel="tag"># Kotlin</a>
              <a href="/tags/Tools/" rel="tag"># Tools</a>
              <a href="/tags/Lint/" rel="tag"># Lint</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Android/2020/01/15/migrate-gradle-build-scripts-to-kotlin/" rel="prev" title="Android Gradle脚本从Groovy迁移到Kotlin DSL">
      <i class="fa fa-chevron-left"></i> Android Gradle脚本从Groovy迁移到Kotlin DSL
    </a></div>
      <div class="post-nav-item">
    <a href="/Flutter/2020/03/13/flutter-built-value-guide/" rel="next" title="Flutter json 2 model with Built Value">
      Flutter json 2 model with Built Value <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Kotlin-Android%E9%A1%B9%E7%9B%AE%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.</span> <span class="nav-text">Kotlin Android项目静态检查工具的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7"><span class="nav-number">1.1.</span> <span class="nav-text">静态检查工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-Lint"><span class="nav-number">1.2.</span> <span class="nav-text">Android Lint</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%9A%84Lint%E8%A7%84%E5%88%99"><span class="nav-number">1.2.1.</span> <span class="nav-text">查看所有的Lint规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-Lint%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.2.</span> <span class="nav-text">Android Lint配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-Lint%E7%8E%B0%E7%8A%B6%E5%9F%BA%E5%87%86%E5%BF%AB%E7%85%A7"><span class="nav-number">1.2.3.</span> <span class="nav-text">Android Lint现状基准快照</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ktlint"><span class="nav-number">1.3.</span> <span class="nav-text">ktlint</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ktlint%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.1.</span> <span class="nav-text">ktlint安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ktlint%E4%BD%BF%E7%94%A8"><span class="nav-number">1.3.2.</span> <span class="nav-text">ktlint使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ktlint%E6%BA%90%E7%A0%81"><span class="nav-number">1.3.3.</span> <span class="nav-text">ktlint源码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#detekt"><span class="nav-number">1.4.</span> <span class="nav-text">detekt</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#detekt%E5%AE%89%E8%A3%85"><span class="nav-number">1.4.1.</span> <span class="nav-text">detekt安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#detekt%E4%BD%BF%E7%94%A8"><span class="nav-number">1.4.2.</span> <span class="nav-text">detekt使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#detekt%E6%BA%90%E7%A0%81"><span class="nav-number">1.4.3.</span> <span class="nav-text">detekt源码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E5%90%ABktlint%E7%9A%84%E8%A7%84%E5%88%99"><span class="nav-number">1.4.4.</span> <span class="nav-text">包含ktlint的规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%92%8CGit-hook%E7%BB%93%E5%90%88"><span class="nav-number">1.5.</span> <span class="nav-text">和Git hook结合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8git-hook"><span class="nav-number">1.5.1.</span> <span class="nav-text">如何使用git hook</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E6%8F%90%E4%BA%A4%E4%B9%8B%E5%89%8D%E8%BF%90%E8%A1%8C%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5"><span class="nav-number">1.5.2.</span> <span class="nav-text">在提交之前运行静态检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95track-%E5%85%B1%E4%BA%ABGit-hooks"><span class="nav-number">1.5.3.</span> <span class="nav-text">如何track, 共享Git hooks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.6.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">1.6.1.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">1.7.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Dandan Meng"
      src="/uploads/avatar.jpeg">
  <p class="site-author-name" itemprop="name">Dandan Meng</p>
  <div class="site-description" itemprop="description">This is a technical blog site of an Android developer.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">84</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">314</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/mengdd" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;mengdd" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.cnblogs.com/mengdd/" title="http:&#x2F;&#x2F;www.cnblogs.com&#x2F;mengdd&#x2F;" rel="noopener" target="_blank">圣骑士Wind@博客园</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.jianshu.com/u/c4192d22f989" title="http:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;c4192d22f989" rel="noopener" target="_blank">圣骑士Wind@简书</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://juejin.im/user/57ca63748ac247006446cf26" title="https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;57ca63748ac247006446cf26" rel="noopener" target="_blank">圣骑士Wind@掘金</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dandan Meng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"6NRSbfxTnKEHn4YEM8Gf4HdP-gzGzoHsz","app_key":"h6jBdqdDSdfOuICNkOVq2DQ0","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://dandanmeng.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://mengdd.github.io/Kotlin/Android/2020/02/08/kotlin-android-lint-tools/";
    this.page.identifier = "Kotlin/Android/2020/02/08/kotlin-android-lint-tools/";
    this.page.title = "Kotlin Android项目静态检查工具的使用";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://dandanmeng.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
